
------------------------
Looking for source files
------------------------

Found: secret.c secret.h

------------------------------
Attempting to build the driver
------------------------------

mkdir tmpdir.123491
/bin/gcc -Wall -fpic -g -m32 -I/home/pn-cs453/lib/asgn4//testlib/include  -include pln.h -o tmpdir.123491/secret.o -c -Dmain=test453main -Dprintf=dt_printf  secret.c
/bin/gcc -Wall -fpic -g -m32 -I/home/pn-cs453/lib/asgn4//testlib/include  -include pln.h -shared -o tmpdir.123491/lib/libsubmitted.so tmpdir.123491/secret.o

--------------------------------
Checking for long lines (no program should have any lines > 80 chars)
--------------------------------



---------------
checking for tmpdir.123491/lib/libsubmitted.so
---------------


--------------------------------------------------------
Test Results:
   These are the results of trying your Secret Keeper
against several programs with different characteristics 
described by the filename.  The output of your program
is compared to a reference output using diff(1).  If they
differ, the test case is a failure.

  Some of the tests, esp. the ones that expect a driver
call (e.g. open()) to fail, require the driver to have
passed a basic open-write-read-close cycle test first
to ensure that the driver isn't just completely broken
and saying no to everything.



Testing (failure details below (/home/pn-cs453/lib/asgn4//testlib/Tests)):
        -----
         1) Just start the driver                         ... ok.
         2) Write once, read once                         ... ok.
         3) Write once, read many                         ... ok.
         4) Write many, read once                         ... ok.
         5) Start, restart, update                        ... ok.
         6) Write, read, twice                            ... ok.
         7) Attempt to open as good user (different gid)  ... ok.
         8) Attempt to open as bad user (uid only)        ... ok.
         9) Attempt to open as bad user (uid & gid)       ... ok.
        10) Attempt to re-read a secret                   ... FAILURE.
        11) Read an unowned secret                        ... FAILURE.
        12) Reopen for writing                            ... FAILURE.
        13) Reopen for reading                            ... ok.
        14) Write a big secret                            ... FAILURE.
        15) Write a big secret, then more                 ... FAILURE.
        16) write/read a secret, reset, do it again       ... ok.
        17) write big read small                          ... ok.
        18) Test live update                              ... ok.
        19) nonstring data                                ... ok.
        20) Open for read and write                       ... ok.
        21) Open for read and write and append            ... ok.
        22) Open for read and append                      ... FAILURE.
        23) Open for write and append                     ... ok.
        24) Test ioctl handoff                            ... ok.
        25) Test bad ioctl                                ... ok.
        26) Test reset when only opened for reading       ... FAILURE.
        27) Safety after long seek: write                 ... ok.
        28) Safety after long seek: read                  ... FAILURE.
        -----
FAILURE. (20/28 passed)


----------------------------
2 Corefile(s) Present:
    core.123359
    core.123824
----------------------------


-----------------------------------------------------------------
Failure Details
-----------------------------------------------------------------
=================================================
TEST 10: Attempt to re-read a secret 

Write a messsge to the secret keeper in one write() call, read it
back, then try to read it again. (should be empty)


----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Hello, world!
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
Submitted produced no standard output.
stderr:
  dt_read returned 15.  Expected 0. (line 76)
  There should have been nothing to read.
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

1,2d0
< Hello, world!
< Test complete.
---------
=================================================
TEST 11: Read an unowned secret

Read a secret from a device where no secret has been written.  Should
result in an immediate EOF.



----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
Submitted produced no standard output.
stderr:
  dt_open unexpectedly returned -1 (line 28)
  dt_open: No space left on device
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

1d0
< Test complete.
---------
=================================================
TEST 12: Reopen for writing

Try to open a secret for writing twice.  Should fail.



----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Performing basic write/read cycle.
  msg: Boo!
  
  Boo!
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
stdout:
  Performing basic write/read cycle.
  msg: Boo!
  
  Boo!
stderr:
  dt_open unexpectedly returned 1 (line 38).  Expected -1.
  dt_open: Success
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

5d4
< Test complete.
---------
=================================================
TEST 14: Write a big secret

Write a secret bigger than the 8K buffer, then read it back.



----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Writing 1048576 bytes to /dev/secret.
  Expecting it to take 8192.
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
stdout:
  Writing 1048576 bytes to /dev/secret.
  Expecting it to take 8192.
stderr:
  dt_write returned -1.  Expected 8192. (line 49)
  dt_write: No space left on device
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

3d2
< Test complete.
---------
=================================================
TEST 15: Write a big secret, then more

Write a secret bigger than the 8K buffer, try to write again (should
get ENOSPC), then read it back.



----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Writing 1048576 bytes to /dev/secret.
  Expecting it to take 8192.
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
stdout:
  Writing 1048576 bytes to /dev/secret.
  Expecting it to take 8192.
stderr:
  dt_write returned -1.  Expected 8192. (line 49)
  dt_write: No space left on device
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

3d2
< Test complete.
---------
=================================================
TEST 22: Open for read and append

Attempt to open for reading and append.  Should fail.
Checks bitfield operations.


----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Performing basic write/read cycle.
  msg: Boo!
  
  Boo!
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
stdout:
  Performing basic write/read cycle.
  msg: Boo!
  
  Boo!
stderr:
  dt_open unexpectedly returned -1 (line 29)
  dt_open: No space left on device
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

5d4
< Test complete.
---------
=================================================
TEST 26: Test reset when only opened for reading

Write a messsge to the secret keeper, then open it for reading but do
not read.  Close.  It should reset. Try to open for writing again.
write and read again.  It should work.


----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Not reading
  Closing read fd. Should reset.
  opening wfd again succeeded.
  MSG2: Does this still work?
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
stdout:
  Not reading
  Closing read fd. Should reset.
stderr:
  dt_open unexpectedly returned -1 (line 70)
  dt_open: No space left on device
  Bad exit status (1)
Submitted produced no error output.

---------------------------------
Stdout differences (< reference > output)
---------------------------------

3,5d2
< opening wfd again succeeded.
< MSG2: Does this still work?
< Test complete.
---------
=================================================
TEST 28: Safety after long seek: read

Write a messsge to the secret keeper, seek far past the end then try
to read.  It could either succeed or fail by the rules, but it
must not crash.


----------
Reference:
----------
console:
  The Secret Safe ready for work.
stdout:
  Performing basic write/read cycle.
  msg: Boo!
  
  Boo!
  Test complete.
Reference produced no error output.
----------
Submitted:
----------
Submitted produced no console output.
Submitted produced no standard output.
stderr:
  Bad exit status (255)
tty:
  Managed process (123824) exited due to signal (Segmentation fault).

---------------------------------
Stdout differences (< reference > output)
---------------------------------

1,5d0
< Performing basic write/read cycle.
< msg: Boo!
< 
< Boo!
< Test complete.
---------
